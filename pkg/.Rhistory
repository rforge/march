devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools:load_all()
devtools::load_all()
?march.dcmm.construct
models <- list()
models[[length(models)+1]] <- HMM
models[[length(models)+1]] <- march.dcmm.construct(y=pewee,seedModel=models[[1]],
orderVC=0,iterBw=10,stopBw=0.001)
models[[length(models)+1]] <- march.dcmm.construct(y=pewee,seedModel=models[[2]],#orderVC=0,iterBw=10,stopBw=0.0001)
)
models <- list()
HMM<-march.dcmm.construct(y=pewee,orderHC=2,orderVC=0,M=2,popSize=2,gen=1,iterBw=1,stopBw=0.0001)
models[[length(models)+1]] <- HMM
models[[length(models)+1]] <- march.dcmm.construct(y=pewee,seedModel=models[[1]],orderVC=0,iterBw=10,stopBw=0.001)
models[[length(models)+1]] <- march.dcmm.construct(y=pewee,seedModel=models[[1]],iterBw=10,stopBw=0.001)
devtools::load_all()
models[[length(models)+1]] <- march.dcmm.construct(y=pewee,seedModel=models[[1]],iterBw=10,stopBw=0.001)
devtools::load_all()
models[[length(models)+1]] <- march.dcmm.construct(y=pewee,seedModel=models[[1]],iterBw=10,stopBw=0.001)
tz<-rep(0,4)
tz==rep(0,4)
AB<-matrix(c(1,2,3,4,0,0,5,0,0,8,1,2),4,3)
sum(AB==0)
sum(AB==0)~=0
devtools::load_all()
devtools::load_all()
setwd("~/")
data <- read.table("dataAndre.txt")
data <- as.matrix(data)
datat <- matrix(0,23,42)
for(i in 1:23){
datat[i,]<-data[14*(i-1)+1,]
}
covariates <- array(0,c(23,42,13))
for(j in 1:13){
for(i in 1:23){
covariates[i,,j] <- data[14*(i-1)+(j+1),]
}
}
ptest <- march.dataset.loadFromDataFrame(datat,covariates=covariates)
# Amodel: the modeling of the hidden transition matrix (mtd, mtdg or complete)
# Cmodel: the modeling of the visible transition matrix (mtd, mtdg or complete)
# AMCovar vector of the size Ncov indicating which covariables are used into the hidden process (0: no, 1:yes)
# CMCovar vector of the size Ncov indicating which covariables are used into the visible process (0: no, 1:yes)
#
d1<-march.dcmm.construct(ptest,orderHC=1,orderVC=1,M=2,gen=2,popSize=4,iterBw=2,
Amodel="complete",Cmodel="complete",AMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0),CMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0))
march.dcmm.nbParams(d1)
setwd("~/Documents/march/pkg")
setwd("~/march/pkg")
devtools::load_all()
march.dcmm.nbParams(d1)
devtools::load_all()
march.dcmm.nbParams(d1)
devtools::load_all()
march.dcmm.nbParams(d1)
d1@APhi
d1@ATCovar
d1@AQ
d1@AQ[1,,]
d1@Pi
2^0*20*1
d1@CPhi[,,1]
d1@CPhi[,,2]
d1@CTCovar
d1@CQ
d1@CQ[,,,1]
d1<-march.dcmm.construct(ptest,orderHC=2,orderVC=1,M=2,gen=2,popSize=4,iterBw=2,
Amodel="complete",Cmodel="complete",AMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0),CMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0))
march.dcmm.nbParams(d1)
d1@APhi
d1@CPhi
d1@AQ
d1@AQ[1,,]
d1<-march.dcmm.construct(ptest,orderHC=2,orderVC=1,M=3,gen=2,popSize=4,iterBw=2,
Amodel="complete",Cmodel="complete",AMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0),CMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0))
d1<-march.dcmm.construct(ptest,orderHC=2,orderVC=1,M=3,gen=1,popSize=3,iterBw=2,
Amodel="complete",Cmodel="complete",AMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0),CMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0))
march.dcmm.nbParams(d1)
d2<-march.dcmm.construct(ptest,orderHC=2,orderVC=1,M=3,gen=2,popSize=4,iterBw=2,
Amodel="complete",Cmodel="complete",AMCovar=0,CMCovar=0)
march.dcmm.nbParams(d2)
d3<-march.dcmm.construct(ptest,orderHC=2,orderVC=1,M=2,gen=2,popSize=4,iterBw=2,
Amodel="mtd",Cmodel="mtd",AMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0),CMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0))
d1<-march.dcmm.construct(ptest,orderHC=2,orderVC=1,M=3,gen=1,popSize=3,iterBw=2,
Amodel="complete",Cmodel="complete",AMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0),CMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0))
devtools::load_all()
d1<-march.dcmm.construct(ptest,orderHC=2,orderVC=1,M=3,gen=1,popSize=3,iterBw=2,
Amodel="complete",Cmodel="complete",AMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0),CMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0))
march.dcmm.nbParams(d1)
d2<-march.dcmm.construct(ptest,orderHC=2,orderVC=1,M=3,gen=2,popSize=4,iterBw=2,
Amodel="complete",Cmodel="complete",AMCovar=0,CMCovar=0)
march.dcmm.nbParams(d2)
d3<-march.dcmm.construct(ptest,orderHC=2,orderVC=1,M=2,gen=2,popSize=4,iterBw=2,
Amodel="mtd",Cmodel="mtd",AMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0),CMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0))
march.dcmm.nbParams(d3)
d4<-march.dcmm.construct(ptest,orderHC=2,orderVC=1,M=2,gen=2,popSize=4,iterBw=2,
Amodel="mtdg",Cmodel="mtdg",AMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0),CMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0))
d1@APhi
d1@ATCovar
d1@AQ
d1@AQ[1,,]
d1@Pi
d1@CPhi
d1@CTCovar
d1@CQ
d1@CQ[1,,,]
d1@AQ[1,,]
d1@AQ[1,5,]<-c(0,0.5,0.5)
march.dcmm.nbParams(d1)
d1@AQ[1,5,]<-c(0,0,0)
march.dcmm.nbParams(d1)
d1@APhi<-c(0,0.5,0.5)
d1@APhi
d1@APhi[1,,]<-c(0,0.5,0.5)
d1@APhi[1,]<-c(0,0.5,0.5)
march.dcmm.nbParams(d1)
d2@APhi
d2@AQ
d2@AQ[1,,]
d2@Pi
d2@CPhi
d2@CQ
d2@CQ[1,,]
d2@CQ[1,,,]
march.dcmm.nbParams(d2)
d2@AQ
d2@AQ[1,,,]
d2@AQ[1,,]
march.dcmm.nbParams(d3)
d3@AQ[1,,]
d3@APhi
d3@ATCovar
d3@AQ[1,,]
d3@Pi
d3@CPhi
d3@CTCovar
d3@CQ
march.dcmm.nbParams(d3)
object<-d3
placeACovar <- which(object@AMCovar==1)
placeCCovar <- which(object@CMCovar==1)
AtmCovar <- 1
if(sum(object@AMCovar>0)){
for (i in 1:sum(object@AMCovar)){
AtmCovar <- AtmCovar*object@y@Kcov[placeACovar[i]]
}
}
#Pi
nbparpi <- 0
if(object@M>1 & object@orderHC>0){
for(t in 1:object@orderHC){
nbparpi <- nbparpi+object@M^(t-1)*AtmCovar*(object@M-1)
for(i in 1:(object@M^(t-1)*AtmCovar)){
for(j in 1:object@M){
if(object@Pi[i,j,t]==0){
nbparpi <- nbparpi-1
}
}
if(sum(object@Pi[i,,t])==0){
nbparpi <- nbparpi+1
}
}
}
}
#A
nbparA <- 0
if(object@M>1){
if(object@Amodel=="complete" & object@APhi[1,1]!=0){
if(object@orderHC==0){
nbparA <- object@M-1-sum(object@AQ[1,1,]==0)
}else{
nbparA <- object@M^object@orderHC*(object@M-1)-sum(object@AQ[1,,]==0)+sum(rowSums(object@AQ[1,,])==0)
}
}else if(object@Amodel=="mtd" & sum(object@APhi[1,1:object@orderHC])>0){
nbparA <- object@M*(object@M-1)-sum(object@AQ[1,,]==0)+sum(rowSums(object@AQ[1,,])==0)
}else if(object@Amodel=="mtdg" & sum(object@APhi[1,1:object@orderHC])>0){
for(ord in 1:object@orderHC){
if(object@APhi[1,ord]!=0){
nbparA <- nbparA+object@M*(object@M-1)-sum(object@AQ[ord,,]==0)+sum(rowSums(object@AQ[ord,,])==0)
}
}
}
if(sum(object@AMCovar)>0){
if(object@Amodel=="complete"){
CCov <- 1
}else{
CCov <- object@orderHC
}
for(ord in 1:sum(object@AMCovar)){
if(object@APhi[1,CCov+ord]!=0){
KC <- object@y@Kcov[placeACovar[ord]]
nbparA <- nbparA+KC*(object@M-1)-sum(object@ATCovar[[ord]]==0)+sum(rowSums(object@ATCovar[[ord]])==0)
}
}
}
#Independent parameters in APhi
nbparA <- nbparA+length(object@APhi[1,])-1-sum(object@APhi[1,]==0)
}
#Number of parameters visible process
nbparC <- 0
for(state in 1:object@M){
if(object@Cmodel=="complete" & object@CPhi[1,1,state]!=0){
if(sum(object@CMCovar)==0){
nbparC <- nbparC+object@y@K^object@orderVC*(object@y@K-1)-sum(object@RB[,,state]==0)+sum(rowSums(object@RB[,,state])==0)
}else{
nbparC <- nbparC+object@y@K^object@orderVC*(object@y@K-1)-sum(object@CQ[1,,,state]==0)+sum(rowSums(object@CQ[1,,,state])==0)
}
}else if(object@Cmodel=="mtd" & sum(object@CPhi[1,1:object@orderVC,state])){
nbparC <- nbparC+object@y@K*(object@y@K-1)-sum(object@CQ[1,,,state]==0)+sum(rowSums(object@CQ[1,,,state])==0)
}else if(object@Cmodel=="mtdg" & sum(object@CPhi[1,1:object@orderVC,state])){
for(ord in 1:object@orderVC){
if(object@CPhi[1,ord,state]!=0){
nbparC <- nbparC+object@y@K*(object@y@K-1)-sum(object@CQ[ord,,,state]==0)+sum(rowSums(object@CQ[ord,,,state])==0)
}
}
}
if(sum(object@CMCovar)>0){
if(object@Cmodel=="complete"){
CCov <- 1
}else{
CCov <- object@orderVC
}
for(ord in 1:sum(object@CMCovar)){
if(object@CPhi[1,CCov+ord,state]!=0){
KC <- object@y@Kcov[placeCCovar[ord]]
nbparC <- nbparC+KC*(object@y@K-1)-sum(object@CTCovar[[ord]][,,state]==0)+sum(rowSums(object@CTCovar[[ord]][,,state])==0)
}
}
}
#Independant parameters in CPhi
nbparC <- nbparC+length(object@CPhi[1,,state])-1-sum(object@CPhi[1,,state]==0)
}
Nbparam <- nbparpi+nbparA+nbparC
Nbparam
nbparA
nbparC
nbparpi
devtools::load_all()
march.dcmm.nbParams(d3)
object@Cmodel=="mtd" & sum(object@CPhi[1,1:object@orderVC,state])!=
0)
object@Cmodel=="mtd" & sum(object@CPhi[1,1:object@orderVC,state])!=0
sum(object@CPhi[1,1:object@orderVC,state])
object@Cmodel=="mtd" & sum(object@CPhi[1,1:object@orderVC,state])
nbparC <- 0
nbparC <- nbparC+object@y@K*(object@y@K-1)-sum(object@CQ[1,,,state]==0)+sum(rowSums(object@CQ[1,,,state])==0)
nbparC
CCov <- object@orderVC
length(object@CPhi[1,,state])-1-sum(object@CPhi[1,,state]==0)
object@CPhi[1,,state]
object@CPhi[1,,2]
object@CPhi[1,,1]
d3@CPhi
d3@CTCovar
rm(list=ls())
gc()
setwd("~/")
data <- read.table("dataAndre.txt")
data <- as.matrix(data)
datat <- matrix(0,23,42)
for(i in 1:23){
datat[i,]<-data[14*(i-1)+1,]
}
covariates <- array(0,c(23,42,13))
for(j in 1:13){
for(i in 1:23){
covariates[i,,j] <- data[14*(i-1)+(j+1),]
}
}
ptest <- march.dataset.loadFromDataFrame(datat,covariates=covariates)
d4<-march.dcmm.construct(ptest,orderHC=2,orderVC=1,M=2,gen=2,popSize=4,iterBw=2,
Amodel="mtdg",Cmodel="mtdg",AMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0),CMCovar=c(1,0,0,0,0,0,1,0,0,0,0,0,0))
march.dcmm.nbParams(d4)
d5<-march.dcmm.construct(ptest,orderHC=2,orderVC=1,M=2,gen=2,popSize=4,iterBw=2,
Amodel="mtd",Cmodel="mtd",AMCovar=0,CMCovar=0)
march.dcmm.nbParams(d5)
d6<-march.dcmm.construct(ptest,orderHC=2,orderVC=1,M=2,gen=2,popSize=4,iterBw=2,
Amodel="mtdg",Cmodel="mtdg",AMCovar=0,CMCovar=0)
march.dcmm.nbParams(d6)
d4@APhi
d4@ATCovar
d4@AQ
d4@AQ[1,,]
d4@AQ[2,,]
d4@CPhi
d4@CQ
d4@CQ[1,,,]
d4@CTCovar
d4@Pi
march.dcmm.nbParams(d4)
march.dcmm.nbParams(d5)
d5@APhi
d5@AQ
d5@Pi
d5@CPhi
d5@CQ
march.dcmm.nbParams(d5)
d5@APhi
d5@AQ[1,,,]
d5@AQ[1,,]
d5@AQ[2,,]
d5@Pi
d5@CPhi
d5@CQ
object<-d5
placeACovar <- which(object@AMCovar==1)
placeCCovar <- which(object@CMCovar==1)
AtmCovar <- 1
if(sum(object@AMCovar>0)){
for (i in 1:sum(object@AMCovar)){
AtmCovar <- AtmCovar*object@y@Kcov[placeACovar[i]]
}
}
#Pi
nbparpi <- 0
if(object@M>1 & object@orderHC>0){
for(t in 1:object@orderHC){
nbparpi <- nbparpi+object@M^(t-1)*AtmCovar*(object@M-1)
for(i in 1:(object@M^(t-1)*AtmCovar)){
for(j in 1:object@M){
if(object@Pi[i,j,t]==0){
nbparpi <- nbparpi-1
}
}
if(sum(object@Pi[i,,t])==0){
nbparpi <- nbparpi+1
}
}
}
}
#A
nbparA <- 0
if(object@M>1){
if(object@Amodel=="complete" & object@APhi[1,1]!=0){
if(object@orderHC==0){
nbparA <- object@M-1-sum(object@AQ[1,1,]==0)
}else{
nbparA <- object@M^object@orderHC*(object@M-1)-sum(object@AQ[1,,]==0)+sum(rowSums(object@AQ[1,,])==0)
}
}else if(object@Amodel=="mtd" & sum(object@APhi[1,1:object@orderHC])>0){
nbparA <- object@M*(object@M-1)-sum(object@AQ[1,,]==0)+sum(rowSums(object@AQ[1,,])==0)
}else if(object@Amodel=="mtdg" & sum(object@APhi[1,1:object@orderHC])>0){
for(ord in 1:object@orderHC){
if(object@APhi[1,ord]!=0){
nbparA <- nbparA+object@M*(object@M-1)-sum(object@AQ[ord,,]==0)+sum(rowSums(object@AQ[ord,,])==0)
}
}
}
if(sum(object@AMCovar)>0){
if(object@Amodel=="complete"){
CCov <- 1
}else{
CCov <- object@orderHC
}
for(ord in 1:sum(object@AMCovar)){
if(object@APhi[1,CCov+ord]!=0){
KC <- object@y@Kcov[placeACovar[ord]]
nbparA <- nbparA+KC*(object@M-1)-sum(object@ATCovar[[ord]]==0)+sum(rowSums(object@ATCovar[[ord]])==0)
}
}
}
#Independent parameters in APhi
nbparA <- nbparA+length(object@APhi[1,])-1-sum(object@APhi[1,]==0)
}
#Number of parameters visible process
nbparC <- 0
for(state in 1:object@M){
if(object@Cmodel=="complete" & object@CPhi[1,1,state]!=0){
if(sum(object@CMCovar)==0){
nbparC <- nbparC+object@y@K^object@orderVC*(object@y@K-1)-sum(object@RB[,,state]==0)+sum(rowSums(object@RB[,,state])==0)
}else{
nbparC <- nbparC+object@y@K^object@orderVC*(object@y@K-1)-sum(object@CQ[1,,,state]==0)+sum(rowSums(object@CQ[1,,,state])==0)
}
}else if(object@Cmodel=="mtd" & sum(object@CPhi[1,1:object@orderVC,state])!=0){
nbparC <- nbparC+object@y@K*(object@y@K-1)-sum(object@CQ[1,,,state]==0)+sum(rowSums(object@CQ[1,,,state])==0)
}else if(object@Cmodel=="mtdg" & sum(object@CPhi[1,1:object@orderVC,state])!=0){
for(ord in 1:object@orderVC){
if(object@CPhi[1,ord,state]!=0){
nbparC <- nbparC+object@y@K*(object@y@K-1)-sum(object@CQ[ord,,,state]==0)+sum(rowSums(object@CQ[ord,,,state])==0)
}
}
}
if(sum(object@CMCovar)>0){
if(object@Cmodel=="complete"){
CCov <- 1
}else{
CCov <- object@orderVC
}
for(ord in 1:sum(object@CMCovar)){
if(object@CPhi[1,CCov+ord,state]!=0){
KC <- object@y@Kcov[placeCCovar[ord]]
nbparC <- nbparC+KC*(object@y@K-1)-sum(object@CTCovar[[ord]][,,state]==0)+sum(rowSums(object@CTCovar[[ord]][,,state])==0)
}
}
}
#Independant parameters in CPhi
nbparC <- nbparC+length(object@CPhi[1,,state])-1-sum(object@CPhi[1,,state]==0)
}
Nbparam <- nbparpi+nbparA+nbparC
nbparA
nbparpi
d5@Pi
AtmCovar
march.dcmm.nbParams(d5)
t<-1
nbparpi <- nbparpi+object@M^(t-1)*AtmCovar*(object@M-1)
nbparpi+object@M^(t-1)*AtmCovar*(object@M-1)
t=2
nbparpi+object@M^(t-1)*AtmCovar*(object@M-1)
object@M^(t-1)*AtmCovar*(object@M-1)
t=1
object@M^(t-1)*AtmCovar*(object@M-1)
AtmCovar<-1
M<-2
orderHC<-2
Pi <- array(0,c(M^(orderHC-1)*AtmCovar,M,orderHC))
Pi[c(1:(M^(1-1)*AtmCovar)),,1] <- 0.1+array(runif(M^(1-1)*AtmCovar*M),c(M^(1-1)*AtmCovar,M))
if(AtmCovar>1){
Pi[c(1:(M^(1-1)*AtmCovar)),,1] <- Pi[c(1:(M^(1-1)*AtmCovar)),,1]/rowSums(Pi[c(1:(M^(1-1)*AtmCovar)),,1])
}else{
Pi[c(1:(M^(1-1)*AtmCovar)),,1] <- Pi[c(1:(M^(1-1)*AtmCovar)),,1]/sum(Pi[c(1:(M^(1-1)*AtmCovar)),,1])
}
if(orderHC>1){
for(i in 2:orderHC){
Pi[c(1:(M^(i-1)*AtmCovar)),,i] <- 0.1+array(runif(M^(i-1)*AtmCovar*M),c(M^(i-1)*AtmCovar,M))
Pi[c(1:(M^(i-1)*AtmCovar)),,i] <- Pi[c(1:(M^(i-1)*AtmCovar)),,i]/rowSums(Pi[c(1:(M^(i-1)*AtmCovar)),,i])
}
}
Pi
setwd("~/march/pkh")
setwd("~/march/pkg")
